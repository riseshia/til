# 2016-02-09

かまってキャット라는 이름으로 이전에 이야기하던 2주 전 til을 리뷰하기 위한 서비스 프로토타입을 세팅했다. 저번에 이야기를 꺼냈더니 코드리뷰도 하면 좋지않냐[..]는 분이 계셔서, 어차피 til도 깃헙에 하고 있었으니 겸사겸사 이것도 처리되게끔 만들어볼 계획.

## Requirement

'2주전 커밋을 확인할 수 있게'

딱 이거 하나만 가지고 시작함.

## Prototyping

깃헙 권한 따오는 문제는 이미 `lazyCat`에서 해봐서 크게 어렵지 않았음. 다만 조심해야 했던 부분은 앱에서 저장소에 대한 읽기 권한을 따와야하는데 이게 `repo`만(읽기/쓰기) 있어서 오용이 우려되었던 점. 이 부분은 [Travis CI](https://docs.travis-ci.com/user/github-oauth-scopes/)에서도 언급되고 있다.

그 다음으로는 있는 권한으로 `octokit`을 통해서 2주전 커밋을 긁어온 뒤에 뿌리기. 여기까진 뭐 크게 어려울 것도 없었음...

## What's the problem?

### `octokit`

`octokit`에서는 [이런 철학](http://wynnnetherland.com/journal/what-makes-a-good-api-wrapper/)을 가지고 있습니다! 라면서 공식 문서가 매우...빈약...해서.... 처음에는 이해를 못해서 좀 헤맸는데, 알고 나니 그럭저럭 쓸만했음. 아무튼 이것 때문에 시간을 좀 잡아먹었고...

### Time consuming on api call

api 호출이 무척 느림. 이건 이전부터 알고 있었던 사실인데, HTTP Request 자체가 무척 느리게 이루어진다고 해야하나... 원인을 아직도 잘 모르는데, 기회가 된다면 좀 알아봐야하지 않을까. 브라우저 등에서는 고속으로 처리하는것을 보면 분명 뭔가 있긴...있어....

아무튼 돌아와서 어차피 알림을 위해서 배치로 처리할 수밖에는 없었는데 그 이유가 좀 더 강해졌달까.

+ Repository Selection이 필요함. 감시할 필요가 없는 저장소에 대한 api 호출을 하면서 시간을 낭비할 필요는 전혀 없음. Travis CI의 동작을 참고하면 좋을 것 같음.

### How to notify?

선택지가 굉장히 많은데, `@haruair`님이 추천해주셨던 텔레그램을 우선 고려하고 있긴 함. 우선 현재 후보군에 있는건 텔레그램/슬랙/메일/트위터. 다른건 대체로 비슷하고, 메일의 경우에 좀 더 많은 정보를 포함할 수 있고, 좀 더 일반적으로 사용할 수 있다는게 중요. 장기적으로는 선택해서 사용할 수 있도록 만들면 좋겠구나.. 싶긴한데 혼자서 유지보수하기엔 쓸모없이 작업이 늘 것 같아서 조심해야할 부분. 다만 메일을 쓰게 되면... 뭐 잘될 때는 그때 고민해도 되긴하는데, Gmail의 메일링 제한을 생각하면 좀...ㅋㅋ.....

추가로 고민할 부분은 어디까지 정보를 한번에 보여줄 것인가. initial commit 같은건 변경된 사항이 너무 많아서... 이런 이레귤러를 생각하면 좀 애매하긴 한데, patch 정보를 전부 보여주거나, 혹은 commit log message랑 거기에 대한 링크를 제공해주는 것도 나쁘진 않을 듯.

### Access token?

지금은 세션에 OAuth를 위한 토큰을 저장하고 있는데, 배치 처리를 하려면 이를 저장해둘...필요가...있어서...

`@ujuc`님이 주기적으로 업데이트 하는게 어떻냐, 는 말씀을 해주셔서 [이런 걸](https://developer.github.com/v3/oauth_authorizations/#update-an-existing-authorization) 발견. 배치 돌 때마다 업데이트하는건 아쉬운대로 방어책은 될듯.
